<script setup lang="ts">
  import type { RouteLocationRaw } from 'vue-router';
  import type { SourceResponse } from '~/shared/types';
  import { SourceTag } from '~ui/source-tag';

  const {
    source = undefined,
    title = undefined,
    to = undefined,
  } = defineProps<{
    source?: SourceResponse;
    title?: string;
    to?: RouteLocationRaw;
    isOpened?: boolean;
  }>();

  const emit = defineEmits<{
    (e: 'open-drawer' | 'navigate'): void;
  }>();

  const { isDesktop } = useDevice();

  function handleClick() {
    if (isDesktop) {
      return emit('open-drawer');
    }

    navigateTo(to);

    return emit('navigate');
  }
</script>

<template>
  <NuxtLink
    v-slot="{ href }"
    v-memo="[to]"
    custom
    :to
  >
    <a
      :href
      @click.exact.prevent.stop="handleClick"
    >
      <div
        class="flex min-h-12.5 w-full items-center gap-3 rounded-xl border border-default px-3 py-1.5 hover:border-accented hover:bg-accented"
        :class="isOpened ? 'bg-accented' : 'bg-elevated'"
      >
        <div
          v-if="$slots.icon"
          class="-ml-2 flex size-11 shrink-0 items-center justify-center border-r border-inherit"
        >
          <div class="text-center text-base leading-none">
            <slot name="icon" />
          </div>
        </div>

        <div
          class="flex flex-auto flex-col justify-center gap-1 overflow-hidden"
        >
          <div class="flex items-center justify-between gap-1">
            <span
              :title
              class="inline-block w-full overflow-hidden text-nowrap text-ellipsis"
            >
              <span class="inline max-w-full text-highlighted">
                <slot name="default" />
              </span>

              <span
                v-if="$slots.english"
                class="inline"
              >
                [<slot name="english" />]
              </span>
            </span>

            <div
              v-if="source"
              class="shrink-0"
            >
              <SourceTag :source />
            </div>
          </div>

          <div
            v-if="$slots.caption"
            class="flex items-center gap-1"
          >
            <slot name="caption" />
          </div>
        </div>
      </div>
    </a>
  </NuxtLink>
</template>
